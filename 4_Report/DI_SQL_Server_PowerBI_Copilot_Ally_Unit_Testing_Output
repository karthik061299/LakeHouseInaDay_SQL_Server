============================================================
Resource Utilization Dashboard - Copilot Prompt Unit Tests & SQL Validation
============================================================
API Cost for Data Model Read: 0.03 USD

------------------------------------------------------------
1. Test Case List
------------------------------------------------------------

Test ID: TC01
Test Description: Validate clustered column chart for Monthly FTE vs Billed FTE by Location - correct aggregation, grouping, and join.
Expected Output: For each month and location, total FTE and billed FTE are correctly summed and grouped, with correct mapping to location.

Test ID: TC02
Test Description: Input validation for FTE values (Total_FTE, Billed_FTE) - check for non-numeric, negative, or null values.
Expected Output: All FTE values are numeric, non-negative, and not null for valid records.

Test ID: TC03
Test Description: Edge case - handle months/locations with no data (empty dataset scenario).
Expected Output: Query returns zero rows or NULLs for months/locations with no FTE data, handled gracefully.

Test ID: TC04
Test Description: Validate stacked bar chart for Project Utilization Rate by Month - correct aggregation and grouping.
Expected Output: For each project and month, utilization rates are correctly aggregated and grouped.

Test ID: TC05
Test Description: Input validation for Project_Utilization - check for values outside 0-1 (0%-100%) or nulls.
Expected Output: All Project_Utilization values are between 0 and 1 and not null.

Test ID: TC06
Test Description: Validate line chart for Submitted vs Approved Timesheet Hours Trend - correct monthly aggregation.
Expected Output: For each month, submitted and approved hours are correctly summed and grouped.

Test ID: TC07
Test Description: Edge case - handle months with submitted hours but no approved hours (or vice versa).
Expected Output: Query returns zero or NULL for missing values, handled gracefully.

Test ID: TC08
Test Description: Validate matrix for Resource Availability & Allocation - correct join, aggregation, and status mapping.
Expected Output: For each resource and project, available hours, actual hours, and status are correctly displayed.

Test ID: TC09
Test Description: Input validation for Available_Hours, Actual_Hours - check for negative or null values.
Expected Output: All available and actual hours are non-negative and not null for valid records.

Test ID: TC10
Test Description: Validate pie chart for FTE/Consultant Categorization - correct count by Employee_Category.
Expected Output: Distinct Resource_Code count per Employee_Category matches expected distribution.

Test ID: TC11
Test Description: Validate donut chart for Billing Category Breakdown - correct sum of Actual_Hours by Category.
Expected Output: For each billing category, sum of Actual_Hours matches expected totals.

Test ID: TC12
Test Description: Validate slicer for Portfolio_Leader - all unique Portfolio_Leader values are present.
Expected Output: List of Portfolio_Leader matches unique values in Go_Dim_Resource.

Test ID: TC13
Test Description: Validate combo chart for Working Days vs Holidays by Location - correct aggregation.
Expected Output: For each location and month, working days and holidays are correctly counted.

Test ID: TC14
Test Description: Validate trend line chart for FTE, Utilization, Billing Over Time - correct time series aggregation.
Expected Output: For each month, Total_FTE, Project_Utilization, and Billed_FTE are correctly aggregated.

Test ID: TC15
Test Description: Validate KPI cards for current month - correct calculation for all KPIs.
Expected Output: KPI values for Total FTE, Billed FTE, Avg Project Utilization, Total Submitted Hours, Total Approved Hours match current month data.

Test ID: TC16
Test Description: Validate treemap for Resource Breakdown by Location & Category - correct grouping and count.
Expected Output: Resource count by Location and Employee_Category matches expected distribution.

Test ID: TC17
Test Description: Validate decomposition tree for Utilization Drivers - correct drill-down by fields.
Expected Output: Project Utilization can be decomposed by Business_Area, Project_Name, Location, Portfolio_Leader.

------------------------------------------------------------
2. SQL Queries to Validate Each Test Case
------------------------------------------------------------

-- TC01: Monthly FTE vs Billed FTE by Location
SELECT
    FORMAT(gu.[Calendar_Date], 'yyyy-MM') AS [Month],
    gr.[Location],
    SUM(gu.[Total_FTE]) AS [Total_FTE],
    SUM(gu.[Billed_FTE]) AS [Billed_FTE]
FROM Gold.Go_Agg_Resource_Utilization gu
LEFT JOIN Gold.Go_Dim_Resource gr ON gu.[Resource_Code] = gr.[Resource_Code]
GROUP BY FORMAT(gu.[Calendar_Date], 'yyyy-MM'), gr.[Location]
ORDER BY [Month], gr.[Location];

-- TC02: Input validation for FTE values
SELECT *
FROM Gold.Go_Agg_Resource_Utilization
WHERE [Total_FTE] IS NULL OR [Billed_FTE] IS NULL OR [Total_FTE] < 0 OR [Billed_FTE] < 0;

-- TC03: Edge case - months/locations with no data
-- (No data will result in no rows; to explicitly show missing months/locations, use a calendar/location cross join)
SELECT c.[Month], l.[Location]
FROM (
    SELECT DISTINCT FORMAT([Calendar_Date], 'yyyy-MM') AS [Month] FROM Gold.Go_Agg_Resource_Utilization
) c
CROSS JOIN (
    SELECT DISTINCT [Location] FROM Gold.Go_Dim_Resource
) l
LEFT JOIN (
    SELECT FORMAT([Calendar_Date], 'yyyy-MM') AS [Month], [Location]
    FROM Gold.Go_Agg_Resource_Utilization gu
    LEFT JOIN Gold.Go_Dim_Resource gr ON gu.[Resource_Code] = gr.[Resource_Code]
    GROUP BY FORMAT([Calendar_Date], 'yyyy-MM'), [Location]
) d ON c.[Month] = d.[Month] AND l.[Location] = d.[Location]
WHERE d.[Month] IS NULL;

-- TC04: Project Utilization Rate by Month
SELECT
    [Project_Name],
    FORMAT([Calendar_Date], 'yyyy-MM') AS [Month],
    AVG([Project_Utilization]) AS [Avg_Utilization]
FROM Gold.Go_Agg_Resource_Utilization
GROUP BY [Project_Name], FORMAT([Calendar_Date], 'yyyy-MM')
ORDER BY [Project_Name], [Month];

-- TC05: Input validation for Project_Utilization
SELECT *
FROM Gold.Go_Agg_Resource_Utilization
WHERE [Project_Utilization] IS NULL OR [Project_Utilization] < 0 OR [Project_Utilization] > 1;

-- TC06: Submitted vs Approved Timesheet Hours Trend
SELECT
    FORMAT([Calendar_Date], 'yyyy-MM') AS [Month],
    SUM([Submitted_Hours]) AS [Total_Submitted_Hours],
    SUM([Approved_Hours]) AS [Total_Approved_Hours]
FROM Gold.Go_Agg_Resource_Utilization
GROUP BY FORMAT([Calendar_Date], 'yyyy-MM')
ORDER BY [Month];

-- TC07: Edge case - months with submitted but no approved hours (or vice versa)
SELECT
    FORMAT([Calendar_Date], 'yyyy-MM') AS [Month],
    SUM([Submitted_Hours]) AS [Total_Submitted_Hours],
    SUM([Approved_Hours]) AS [Total_Approved_Hours]
FROM Gold.Go_Agg_Resource_Utilization
GROUP BY FORMAT([Calendar_Date], 'yyyy-MM')
HAVING SUM([Submitted_Hours]) = 0 OR SUM([Approved_Hours]) = 0;

-- TC08: Resource Availability & Allocation Matrix
SELECT
    gu.[Resource_Code],
    gu.[Project_Name],
    gu.[Available_Hours],
    gu.[Actual_Hours],
    gp.[Status]
FROM Gold.Go_Agg_Resource_Utilization gu
LEFT JOIN Gold.Go_Dim_Project gp ON gu.[Project_Name] = gp.[Project_Name];

-- TC09: Input validation for Available_Hours, Actual_Hours
SELECT *
FROM Gold.Go_Agg_Resource_Utilization
WHERE [Available_Hours] IS NULL OR [Available_Hours] < 0 OR [Actual_Hours] IS NULL OR [Actual_Hours] < 0;

-- TC10: FTE/Consultant Categorization Pie Chart
SELECT
    [Employee_Category],
    COUNT(DISTINCT [Resource_Code]) AS [Resource_Count]
FROM Gold.Go_Dim_Resource
GROUP BY [Employee_Category];

-- TC11: Billing Category Breakdown Donut Chart
SELECT
    gp.[Category],
    SUM(gu.[Actual_Hours]) AS [Total_Actual_Hours]
FROM Gold.Go_Agg_Resource_Utilization gu
LEFT JOIN Gold.Go_Dim_Project gp ON gu.[Project_Name] = gp.[Project_Name]
GROUP BY gp.[Category];

-- TC12: Portfolio_Leader Slicer
SELECT DISTINCT [Portfolio_Leader]
FROM Gold.Go_Dim_Resource
WHERE [Portfolio_Leader] IS NOT NULL;

-- TC13: Working Days vs Holidays by Location
SELECT
    FORMAT(dd.[Calendar_Date], 'yyyy-MM') AS [Month],
    dh.[Location],
    SUM(CASE WHEN dd.[Is_Working_Day] = 1 THEN 1 ELSE 0 END) AS [Working_Days],
    COUNT(dh.[Holiday_ID]) AS [Holiday_Count]
FROM Gold.Go_Dim_Date dd
LEFT JOIN Gold.Go_Dim_Holiday dh ON dd.[Calendar_Date] = dh.[Holiday_Date]
GROUP BY FORMAT(dd.[Calendar_Date], 'yyyy-MM'), dh.[Location]
ORDER BY [Month], dh.[Location];

-- TC14: Trend Analysis - FTE, Utilization, Billing Over Time
SELECT
    FORMAT([Calendar_Date], 'yyyy-MM') AS [Month],
    SUM([Total_FTE]) AS [Total_FTE],
    AVG([Project_Utilization]) AS [Avg_Utilization],
    SUM([Billed_FTE]) AS [Total_Billed_FTE]
FROM Gold.Go_Agg_Resource_Utilization
GROUP BY FORMAT([Calendar_Date], 'yyyy-MM')
ORDER BY [Month];

-- TC15: KPI Cards for Current Month
DECLARE @CurrentMonth VARCHAR(7) = FORMAT(GETDATE(), 'yyyy-MM');
SELECT
    SUM([Total_FTE]) AS [Total_FTE],
    SUM([Billed_FTE]) AS [Billed_FTE],
    AVG([Project_Utilization]) AS [Avg_Project_Utilization],
    SUM([Submitted_Hours]) AS [Total_Submitted_Hours],
    SUM([Approved_Hours]) AS [Total_Approved_Hours]
FROM Gold.Go_Agg_Resource_Utilization
WHERE FORMAT([Calendar_Date], 'yyyy-MM') = @CurrentMonth;

-- TC16: Resource Breakdown by Location & Category Treemap
SELECT
    [Location],
    [Employee_Category],
    COUNT([Resource_Code]) AS [Resource_Count]
FROM Gold.Go_Dim_Resource
GROUP BY [Location], [Employee_Category];

-- TC17: Decomposition Tree for Utilization Drivers
SELECT
    [Business_Area],
    [Project_Name],
    gr.[Location],
    gr.[Portfolio_Leader],
    AVG([Project_Utilization]) AS [Avg_Utilization]
FROM Gold.Go_Agg_Resource_Utilization gu
LEFT JOIN Gold.Go_Dim_Resource gr ON gu.[Resource_Code] = gr.[Resource_Code]
GROUP BY [Business_Area], [Project_Name], gr.[Location], gr.[Portfolio_Leader];

============================================================
